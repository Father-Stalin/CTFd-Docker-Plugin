{% extends "container_base.html" %}

{% block menu %}
<li class="nav-item">
    <a class="nav-link" href="/containers/admin/dashboard">&#128279; Instances</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="/containers/admin/settings">&#128279; Settings</a>
</li>
<li class="nav-item">
    <a class="nav-link active" data-toggle="pill" href="#flag">Share flag</a>
</li>
{% endblock %}

{% block panel %}
{% include "components/errors.html" %}

<h1>Cheat Monitor</h1>

{% if cheat_logs|length == 0 %}
<p>No cheating events recorded yet.</p>
{% else %}
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Time</th>
            <th>Challenge</th>
            <th>Original Owner</th>
            <th>Second Submitter</th>
            <th>Flag</th>
        </tr>
    </thead>
    <tbody>
    {% for log in cheat_logs %}
        <tr>
            <td>
                <!-- Convert timestamp from seconds to a user-friendly date -->
                {% set dt = log.timestamp|datetimeformat("long") %} 
                {{ dt }}
            </td>
            <td>
                <!-- Link to the challenge admin page -->
                <a href="{{ url_for('admin.challenges_detail', challenge_id=log.challenge_id) }}">
                    Challenge #{{ log.challenge_id }}
                </a>
            </td>
            <td>
                <!-- Show either team or user, depending on what is set -->
                {% if log.original_team_id %}
                    Team: {{ log.original_team.name }} (ID {{ log.original_team_id }})
                {% elif log.original_user_id %}
                    User: {{ log.original_user.name }} (ID {{ log.original_user_id }})
                {% else %}
                    Unknown
                {% endif %}
            </td>
            <td>
                {% if log.second_team_id %}
                    Team: {{ log.second_team.name }} (ID {{ log.second_team_id }})
                {% elif log.second_user_id %}
                    User: {{ log.second_user.name }} (ID {{ log.second_user_id }})
                {% else %}
                    Unknown
                {% endif %}
            </td>
            <td>
                {{ log.reused_flag }}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
